@()
    @main("Reports", "Reports") {
        <div class="col-md-12" id="report-container">
            <div class="row">
                <div class="form-group mb-3 col-md-6">
                    <div class="row">
                        <label for="reportStart" class="mb-3 col-md-12 mb-3 col-md-form-label">Start Date</label>
                        <div class="mb-3 col-md-12">
                            <input id="reportStart" class="form-control" type="date" name="reportStart" value="" onchange="createCharts()">
                        </div>
                    </div>
                </div>
                <div class="form-group mb-3 col-md-6">
                    <div class="row">
                        <label for="reportEnd" class="mb-3 col-md-12 mb-3 col-md-form-label">End Date</label>
                        <div class="mb-3 col-md-12">
                            <input id="reportEnd" class="form-control" type="date" name="reportEnd" value="" onchange="createCharts()">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row row-eq-height">
                <div class="mb-2 col-md-3 animated fadeInUp">
                    <div class="card">
                        <div class="card-header">
                            <h3>Appointments</h3>
                        </div>
                        <div>
                            <h5>There are</h5><h1><span id="appointmentCount"></span></h1><h5>Appointments</h5>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" id="reports">
                <div class="mb-3 col-md-4">
                    <h1 class="center">Appointment Types</h1>
                    <br/>
                    <canvas id="Type"></canvas>
                </div>
                <div class="mb-3 col-md-4">
                    <h1 class="center">Services</h1>
                    <br/>
                    <canvas id="Service"></canvas>
                </div>
                <div class="mb-3 col-md-4">
                    <h1 class="center">Weekly/One-Time</h1>
                    <br/>
                    <canvas id="Weekly"></canvas>
                </div>
            </div>
        </div>

        <script type="text/javascript">
                let rangeData = {
                    appointments: 0
                };

                let reportStart = $('#reportStart');
                let reportEnd = $('#reportEnd');
                let Charts = [];
                let chartData = [];
                /* Create Charts On Page Load*/
                $(document).ready(function () {
                    reportStart.val(moment().subtract(7, "days").format("YYYY-MM-DD"));
                    reportEnd.val(moment().format("YYYY-MM-DD"));
                    createCharts();
                });

                function createCharts() {
                    getData();
                    makeCharts();
                }

                function makeCharts() {
                    for (let i = 0; i< Charts.length; i++) {
                        let labels = [];
                        let data = [];
                        $.each(chartData[i], function( key, value ) {
                            labels.push(key);
                            data.push(value);
                        });
                        const chartone = document.getElementById(Charts[i]).getContext('2d');
                        if(chartone !== null) {
                            new Chart(chartone, {
                                type: 'doughnut',
                                data: {
                                    datasets: [{
                                        data: data,
                                        backgroundColor: palette('tol', data.length).map(function (hex) {
                                            return '#' + hex;
                                        })
                                    }],
                                    labels: labels,
                                },
                            })
                        }
                    }
                }
                function getData() {
                    $.ajax({
                        async: false,
                        url: '/AppointmentStatistics/'+ moment(reportStart.val()).valueOf()+"/"+moment(reportEnd.val()).valueOf(),
                        type: 'GET',
                        success: function (response) {
                            $(response).each(function (){
                                for (let i=0; i < Object.getOwnPropertyNames(this).length; i++){
                                    Charts.push(Object.getOwnPropertyNames(this)[i]);
                                    chartData.push(Object.values(this)[i]);
                                }
                            })
                        }
                    });
                    $("#appointmentCount").html(rangeData.appointments);
                }
        </script>

    }
