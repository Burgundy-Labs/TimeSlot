@()
@main("Dashboard", "Your Dashboard") {
    @helper.CSRF.formField
    <div class="dashCards">
        <div class="row">
            <div class="col-lg-10">
                <div class="card">
                    <div class="card-header">
                        <h6> Your Profile</h6>
                    </div>
                    <div class="card-block">
                        <p>
                            Hello <b>@{UserController.getCurrentUser.getDisplayName}</b>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-lg-2">
                <div class="card text-center">
                    <div class="card-header">
                        <h6>Schedule New Appointment</h6>
                    </div>
                    <div class="card-block">
                        <button onclick="createNewAppointment()" class="btn btn-outline-primary">
                            Schedule New Appointment</button>
                    </div>
                </div>
            </div>
        </div>
        <br/>
        <div class="row">
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h6>Appointment Calendar</h6>
                    </div>
                    <div>
                        <div id="appointmentCalendar"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h6 class="float-left">Next Five Appointments</h6>
                        <a href="/Appointments" class="btn btn-outline-light float-right align-middle">
                            View Appointment List</a>
                    </div>
                    @partials.components._nextFiveAppointments()
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
            $(document).ready(function() {
                $('#appointmentCalendar').fullCalendar({
                    header: false,
                    defaultView: 'basicWeek',
                    height: 'auto',
                    editable: false,
                    weekends: false,
                    selectable: false,
                    events: function (start, end, timezone, callback) {
                        const csrfToken = $('input[name="csrfToken"]').attr('value');
                        $.ajaxSetup({
                            beforeSend: function (xhr) {
                                xhr.setRequestHeader('Csrf-Token', csrfToken);
                            }
                        });
                        $.ajax({
                            url: '/appointmentsForUser/' + '@UserController.getCurrentUser.getRole'+"/" +'@UserController.getCurrentUser.getUid',
                            type: 'GET',
                            success: function (response) {
                                const events = [];
                                $(response).each(function () {
                                    const event = {
                                        id: $(this).attr('availabilityId'),
                                        title: $(this).attr('studentName'),
                                        start: moment($(this).attr('startDate')).format(),
                                        end: moment($(this).attr('endDate')).format(),
                                        dow: [],
                                    };
                                    events.push(event);
                                });
                                callback(events);
                            }
                        })
                    },
                });
            });
    </script>
    @partials.components._createNewAppointmentFlow_Scripts()
}