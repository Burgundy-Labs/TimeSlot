@import controllers.ApplicationComponents.AppointmentTypes
@import controllers.Databases.UserDB
@import controllers.ApplicationComponents.Services
@()
@main("Dashboard", "Your Dashboard") {
    @helper.CSRF.formField
    <div class="dashCards">
    <div class="row">
        <div class="col-lg-10">
            <div class="card">
                <div class="card-header">
                    <h6> Your Profile</h6>
                </div>
                <div class="card-block">
                    Information On Your Profile
                </div>
            </div>
        </div>
        <div class="col-lg-2">
            <div class="card text-center">
                <div class="card-header">
                    <h6>Schedule New Appointment</h6>
                </div>
                <div class="card-block">
                    <button onclick="createNewAppointment()" class="btn btn-outline-primary">Schedule New Appointment</button>
                </div>
            </div>
        </div>
    </div>
    <br/>
    <div class="row">
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h6>Appointment Calendar</h6>
                </div>
                <div class="card-block">
                    Calendar
                </div>
            </div>
        </div>
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h6 class="float-left">Appointment List</h6>
                    <a href="/Appointments" class="btn btn-outline-light float-right align-middle">View Appointment List</a>
                </div>
                @partials.components._nextFiveAppointments()
            </div>
        </div>
    </div>
    </div>
    @partials.components._createNewAppointmentFlow_Scripts()
    <script type="text/javascript">
            function createNewAppointment() {
                var content = ` @{ partials.components._createNewAppointmentFlow() } `;
                $.dialog({
                    columnClass: 'col-md-12',
                    title: "New Appointment",
                    content: content,
                    buttons: {
                        cancel: {
                            text: "Cancel Appointment Creation"
                        }
                    }
                });
                $(function () {
                    $('.stepper').activateStepper();
                    $("#createNewAppointment").on('click', function () {
                        if (selectedEvents.length <= 0) {
                            $.alert({
                                title: 'Alert',
                                content: 'No appointments slots have been selected.'
                            });
                        } else {
                            var appointment = {
                                /* TOOD: If desired to allow multiple events - change this*/
                                id: selectedEvents[0].id,
                                startDate: selectedEvents[0].start,
                                endDate: selectedEvents[0].end
                            };
                            var form = {
                                appointmentType: $('#appointmentType').val(),
                                serviceType: $('#serviceType').val(),
                                coachId: $('#coachId').val(),
                                studentId: firebase.auth().currentUser.uid,
                                startDate: appointment.startDate,
                                endDate: appointment.endDate,
                                appointmentNotes: $('#appointmentNotes').val(),
                                present: false
                            };
                            $.confirm({
                                title: 'New Appointment',
                                content: "<div class='appointmentDetails'>Your appointment details: <br/>" +
                                "<b>Appointment Type:</b> " + form.appointmentType + " <br/>" +
                                "<b>Coach:</b> " + $("#coachId option:selected").text() + " <br/>" +
                                "<b>Date:</b>" + moment(appointment.startDate).format('dddd, MMMM Do, YYYY h:mm A') + " -" + moment(appointment.endDate).format('h:mm A') + "<br/>" +
                                "</div>",
                                theme: 'modern',
                                buttons: {
                                    yes: {
                                        text: 'Create Appointment',
                                        btnClass: 'btn-primary',
                                        keys: ['enter', 'shift'],
                                        action: function () {
                                            /* Create appointment Here*/
                                            var csrfToken = $('input[name="csrfToken"]').attr('value');
                                            $.ajaxSetup({
                                                beforeSend: function (xhr) {
                                                    xhr.setRequestHeader('Csrf-Token', csrfToken);
                                                }
                                            });
                                            $.ajax({
                                                url: '/createAppointment',
                                                type: 'POST',
                                                data: JSON.stringify(form),
                                                contentType: 'application/json',
                                                success: function () {
                                                    createAlert("success", "Appointment Created!");
                                                },
                                                error: function () {
                                                    createAlert('danger', 'Appointment creation failed.');
                                                }
                                            });
                                        }
                                    },
                                    no: {
                                        text: 'Cancel Appointment',
                                        action: function () {
                                            createAlert("warning", "Appointment Not Created");
                                        }
                                    }
                                }
                            });
                        }
                    });
                });
            }
    </script>
}

