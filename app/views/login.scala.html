@import ApplicationComponents.Application
@()
<!DOCTYPE html>
<html>
    <head>
        <title>Login</title>
        <script type="text/javascript" src="@routes.Assets.at("javascripts/outdated.js")"></script>
        @partials._head()
        </head>
    <body class="body_bg">
        <script type="text/javascript">
                // FirebaseUI config.
                @if(UserController.getCurrentRole == null) {
                        localStorage.clear();
                }
                if ( localStorage.getItem("firebaseui::rememberedAccounts") !== null ) {
                    window.location = "/Dashboard";
                }
                let uiConfig = {
                    callbacks: {
                        signInSuccess: function (user, credential, redirectUrl) {
                            let userSignIn = {
                                displayName: user.displayName,
                                email: user.email,
                                emailVerified: user.emailVerified,
                                photoURL: user.photoURL,
                                uid: user.uid,
                                phoneNumber: user.phoneNumber
                            };
                            /* TODO: get mtu.edu from DB */
                            if(!(user.email.split('@@')[1] === 'mtu.edu')){
                                $.alert({
                                    title: 'Alert',
                                    content: 'Please sign-in using an @@mtu.edu email address',
                                    buttons: {
                                        confirm: {
                                            keys: ['enter'],
                                            text: "Okay",
                                            btnClass: "btn-primary",
                                            action: function() {
                                                signout();
                                            }
                                        }
                                    }
                                });
                                return false;
                            } else {
                                /* POST signed in user to Login Controller*/
                                $.ajax({
                                    url: '/signedIn',
                                    type: 'POST',
                                    data: JSON.stringify(userSignIn),
                                    contentType: 'application/json',
                                    success: function() {
                                        window.location = "/Dashboard";
                                    },
                                    error: function (err) {
                                        console.log(err);
                                    }
                                });
                                return false;
                            }
                        }
                    },
                    signInSuccessUrl: '/Dashboard',
                    signInOptions: [{
                        provider: firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                        authMethod: "https://accounts.google.com",
                        clientId: '@Application.getConfig.getString("authConfig.clientId")',
                    }],

                    credentialHelper: firebaseui.auth.CredentialHelper.GOOGLE_YOLO,
                // Terms of service url.
                    tosUrl: '/Terms'
                };

                // Initialize the FirebaseUI Widget using FirestoreDB.
                var ui = new firebaseui.auth.AuthUI(firebase.auth());
                ui.disableAutoSignIn();
                // The start method will wait until the DOM is loaded.
                ui.start('#firebaseui-auth-container', uiConfig);
        </script>
        @helper.CSRF.formField
        <div class="loginJumbotron">
                <div class="jumbotron d-flex align-items-center">
                    <div class="container">
                        <div class="col-sm-12 col-md-6 col-lg-6 center">
                            <img src="@routes.Assets.at("/images/TimeSlot.svg")" class="mb-2 img-fluid"/>
                        </div>
                        <h2>@SettingsController.getSettings.getCenterName</h2>
                        <br/>
                        <p>
                            Please sign in below to view, schedule, and manage appointments.
                        </p>
                        <div id="firebaseui-auth-container" class="btn"></div>
                        <div id="sign-out"></div>
                    </div>
                </div>
            </div>
        @partials._footer()
    </body>
</html>